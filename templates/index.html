<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyPython API - Aprenda Fazendo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'Fira Code', monospace; }
        
        /* Anima√ß√µes */
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
        
        .tutorial-highlight {
            position: relative;
            z-index: 50;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.5);
            background-color: white;
        }
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 40;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800" x-data="app()">

    <!-- Toast Notifications -->
    <div class="fixed top-4 right-4 z-[100] space-y-2">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.visible" x-transition.duration.300ms
                 class="p-4 rounded-lg shadow-lg flex items-center gap-3 min-w-[300px] border-l-4"
                 :class="{
                     'bg-white border-green-500 text-slate-700': toast.type === 'success',
                     'bg-white border-red-500 text-slate-700': toast.type === 'error',
                     'bg-white border-blue-500 text-slate-700': toast.type === 'info'
                 }">
                <span x-text="toast.emoji" class="text-xl"></span>
                <div>
                    <h4 class="font-bold text-sm" x-text="toast.title"></h4>
                    <p class="text-xs opacity-90" x-text="toast.message"></p>
                </div>
            </div>
        </template>
    </div>

    <!-- Tutorial Overlay -->
    <div x-show="tutorial.active" class="overlay" x-transition.opacity></div>

    <!-- Tutorial Box -->
    <div x-show="tutorial.active" 
         class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[60] bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg border border-indigo-100"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-10"
         x-transition:enter-end="opacity-100 translate-y-0">
        <div class="flex items-start gap-4">
            <div class="bg-indigo-100 p-3 rounded-full text-indigo-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
            </div>
            <div class="flex-1">
                <h3 class="font-bold text-lg text-indigo-900 mb-1" x-text="currentStep.title"></h3>
                <p class="text-slate-600 text-sm mb-4 leading-relaxed" x-text="currentStep.text"></p>
                
                <div class="flex justify-between items-center">
                    <span class="text-xs text-slate-400 font-mono" x-text="`Passo ${tutorial.step + 1}/${tutorialSteps.length}`"></span>
                    <div class="space-x-2">
                        <button @click="endTutorial" class="text-xs text-slate-500 hover:text-slate-800 px-3 py-2">Pular</button>
                        <button @click="nextStep" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm">
                            <span x-text="tutorial.step === tutorialSteps.length - 1 ? 'Concluir' : 'Pr√≥ximo'"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-30">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 text-white w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm">EP</div>
                <h1 class="font-bold text-slate-800 hidden md:block">EasyPython Explorer</h1>
            </div>

            <!-- Route Switcher -->
            <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200" :class="{'tutorial-highlight': tutorial.step === 1}">
                <button @click="switchRoute('tasks')" 
                        class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
                        :class="currentRoute === 'tasks' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                    Minhas Tarefas
                </button>
                <button @click="switchRoute('users')" 
                        class="px-4 py-1.5 rounded-md text-sm font-medium transition-all"
                        :class="currentRoute === 'users' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'">
                    Usu√°rios
                </button>
            </div>

            <div class="flex items-center gap-3">
                <!-- Level Toggle -->
                <div class="hidden md:flex items-center gap-2 mr-4 bg-slate-50 px-3 py-1.5 rounded-full border border-slate-200">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Modo:</span>
                    <button @click="userLevel = 'beginner'" 
                            class="text-xs font-medium px-2 py-0.5 rounded transition"
                            :class="userLevel === 'beginner' ? 'bg-green-100 text-green-700' : 'text-slate-400 hover:text-slate-600'">
                        Iniciante
                    </button>
                    <button @click="userLevel = 'advanced'" 
                            class="text-xs font-medium px-2 py-0.5 rounded transition"
                            :class="userLevel === 'advanced' ? 'bg-purple-100 text-purple-700' : 'text-slate-400 hover:text-slate-600'">
                        Dev
                    </button>
                </div>
                
                <button @click="startTutorial" class="text-indigo-600 hover:bg-indigo-50 p-2 rounded-full transition" title="Reiniciar Tutorial">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Interactive App -->
        <div class="lg:col-span-7 space-y-8">
            
            <!-- Context Header -->
            <div class="bg-indigo-600 text-white rounded-2xl p-6 shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 opacity-10">
                    <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-2 opacity-80">
                        <span class="uppercase text-xs font-bold tracking-wider">Rota Atual</span>
                        <span class="font-mono bg-indigo-700 px-2 py-0.5 rounded text-xs" x-text="`/api/${currentRoute}/`"></span>
                    </div>
                    <h2 class="text-2xl font-bold mb-2" x-text="currentRoute === 'tasks' ? 'Gerenciador de Tarefas' : 'Visualizador de Usu√°rios'"></h2>
                    <p class="text-indigo-100 text-sm max-w-lg">
                        <span x-show="currentRoute === 'tasks'">Aqui voc√™ pode criar, listar, editar e remover tarefas. Cada a√ß√£o que voc√™ faz aqui envia um pedido real para o servidor.</span>
                        <span x-show="currentRoute === 'users'">Esta rota √© apenas de leitura. Voc√™ pode ver os usu√°rios cadastrados no sistema, mas n√£o pode alter√°-los por aqui.</span>
                    </p>
                </div>
            </div>

            <!-- Create Form (POST) -->
            <div x-show="methods.includes('POST')" 
                 class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm transition hover:shadow-md"
                 :class="{'tutorial-highlight': tutorial.step === 2}">
                
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                            Criar Novo Registro
                            <span x-show="userLevel === 'advanced'" class="bg-indigo-100 text-indigo-700 text-[10px] px-2 py-0.5 rounded font-mono">POST</span>
                        </h3>
                        <p class="text-slate-500 text-sm mt-1">Preencha os dados abaixo para enviar ao servidor.</p>
                    </div>
                </div>

                <form @submit.prevent="createItem" class="space-y-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-700">T√≠tulo da Tarefa <span class="text-red-500">*</span></label>
                        <input type="text" x-model="newItem.title" 
                               class="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"
                               placeholder="Ex: Estudar Python" required>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-700">Descri√ß√£o <span class="text-slate-400 font-normal">(Opcional)</span></label>
                        <textarea x-model="newItem.description" rows="2"
                                  class="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"
                                  placeholder="Detalhes adicionais..."></textarea>
                    </div>

                    <div class="pt-2">
                        <button type="submit" 
                                class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 px-6 rounded-lg transition flex items-center justify-center gap-2"
                                :disabled="isLoading">
                            <span x-show="isLoading" class="animate-spin">‚åõ</span>
                            <span>Enviar para o Servidor</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- List (GET) -->
            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden"
                 :class="{'tutorial-highlight': tutorial.step === 3}">
                <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                            Lista de Registros
                            <span x-show="userLevel === 'advanced'" class="bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded font-mono">GET</span>
                        </h3>
                        <p class="text-slate-500 text-sm mt-1" x-text="`Total: ${items.length} itens encontrados`"></p>
                    </div>
                    <button @click="fetchItems" class="text-indigo-600 hover:text-indigo-800 p-2 hover:bg-indigo-50 rounded-lg transition" title="Atualizar Lista">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    </button>
                </div>

                <div class="divide-y divide-slate-100">
                    <template x-for="item in items" :key="item.id">
                        <div class="p-4 hover:bg-slate-50 transition group flex items-start gap-4">
                            <!-- Checkbox for Tasks -->
                            <div x-show="currentRoute === 'tasks'" class="pt-1">
                                <button @click="toggleItem(item)" 
                                        class="w-6 h-6 border-2 rounded-lg flex items-center justify-center transition duration-200"
                                        :class="item.completed ? 'bg-green-500 border-green-500' : 'border-slate-300 hover:border-indigo-500'">
                                    <svg x-show="item.completed" class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                </button>
                            </div>

                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-medium text-slate-800 text-lg" 
                                        :class="{'line-through text-slate-400': item.completed && currentRoute === 'tasks'}" 
                                        x-text="item.title || item.username"></h4>
                                    
                                    <!-- Actions -->
                                    <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity" x-show="currentRoute === 'tasks'">
                                        <button @click="deleteItem(item.id)" 
                                                class="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition" 
                                                title="Deletar Item">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-slate-500 text-sm mt-1" x-text="item.description || item.email || 'Sem descri√ß√£o'"></p>
                                
                                <!-- Dev Info -->
                                <div x-show="userLevel === 'advanced'" class="mt-2 pt-2 border-t border-slate-100">
                                    <code class="text-[10px] text-slate-400 font-mono" x-text="`ID: ${item.id} ‚Ä¢ Created: ${new Date(item.created_at || item.date_joined).toLocaleDateString()}`"></code>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <div x-show="items.length === 0" class="p-12 text-center">
                        <div class="bg-slate-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg>
                        </div>
                        <h4 class="text-slate-900 font-medium">Nenhum item encontrado</h4>
                        <p class="text-slate-500 text-sm mt-1">Utilize o formul√°rio acima para criar o primeiro registro.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Educational Console -->
        <div class="lg:col-span-5 space-y-6">
            
            <!-- Learning Card -->
            <div class="bg-gradient-to-br from-indigo-50 to-white rounded-2xl p-6 border border-indigo-100 shadow-sm relative overflow-hidden">
                <div class="flex items-start gap-4 relative z-10">
                    <div class="bg-white p-3 rounded-xl shadow-sm text-2xl">üéì</div>
                    <div>
                        <h3 class="font-bold text-indigo-900">Como funciona?</h3>
                        <p class="text-indigo-800/80 text-sm mt-2 leading-relaxed" x-show="userLevel === 'beginner'">
                            Este site √© um "Frontend" (interface visual) que conversa com o "Backend" (servidor Django).
                            <br><br>
                            Quando voc√™ clica em "Adicionar", seu navegador envia uma carta digital (requisi√ß√£o) para o servidor pedindo para salvar os dados. O servidor responde dizendo se deu certo.
                        </p>
                        <p class="text-indigo-800/80 text-sm mt-2 leading-relaxed" x-show="userLevel === 'advanced'">
                            A aplica√ß√£o utiliza <strong>Fetch API</strong> para comunicar com o Django REST Framework.
                            <br><br>
                            Observe o console abaixo para ver os headers, payloads e status codes reais de cada transa√ß√£o HTTP. O sistema suporta CORS e CSRF handling autom√°tico.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Console Log -->
            <div class="bg-slate-900 rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[600px] border border-slate-800"
                 :class="{'tutorial-highlight': tutorial.step === 4}">
                <div class="bg-slate-950 px-4 py-3 border-b border-slate-800 flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        <span class="ml-2 text-xs font-mono text-slate-400">Console de Rede</span>
                    </div>
                    <button @click="logs = []" class="text-xs text-slate-500 hover:text-white transition">Limpar</button>
                </div>

                <div class="flex-1 overflow-y-auto p-4 space-y-4 font-mono text-xs" id="console-logs">
                    <template x-for="log in logs" :key="log.id">
                        <div class="animate-slide-in border-l-2 pl-3 py-1"
                             :class="{
                                 'border-green-500': log.status < 300,
                                 'border-red-500': log.status >= 400,
                                 'border-blue-500': log.status === 0
                             }">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center gap-2">
                                    <span class="font-bold px-1.5 py-0.5 rounded text-[10px]"
                                          :class="{
                                              'bg-green-500/20 text-green-400': log.method === 'GET',
                                              'bg-indigo-500/20 text-indigo-400': log.method === 'POST',
                                              'bg-yellow-500/20 text-yellow-400': log.method === 'PATCH',
                                              'bg-red-500/20 text-red-400': log.method === 'DELETE',
                                              'bg-purple-500/20 text-purple-400': log.method === 'OPTIONS'
                                          }" x-text="log.method"></span>
                                    <span class="text-slate-300" x-text="log.url"></span>
                                </div>
                                <span :class="log.status < 300 ? 'text-green-400' : 'text-red-400'" x-text="log.status || 'PENDING'"></span>
                            </div>
                            
                            <!-- Beginner Explanation -->
                            <div x-show="userLevel === 'beginner'" class="text-slate-400 mt-1 italic">
                                <span x-show="log.method === 'GET'">üì• Pediu dados ao servidor...</span>
                                <span x-show="log.method === 'POST'">üì§ Enviou novos dados para salvar...</span>
                                <span x-show="log.method === 'DELETE'">üóëÔ∏è Pediu para apagar um item...</span>
                                <span x-show="log.method === 'PATCH'">üìù Pediu para atualizar um detalhe...</span>
                            </div>

                            <!-- Advanced Details -->
                            <div x-show="userLevel === 'advanced' && log.payload" class="mt-2 bg-slate-800/50 p-2 rounded text-slate-300 overflow-x-auto">
                                <div class="text-[10px] text-slate-500 mb-1">PAYLOAD:</div>
                                <pre x-text="JSON.stringify(log.payload, null, 2)"></pre>
                            </div>
                        </div>
                    </template>
                    
                    <div x-show="logs.length === 0" class="text-center text-slate-600 mt-20">
                        <p>Aguardando intera√ß√µes...</p>
                        <p class="text-[10px] mt-2">Clique nos bot√µes ao lado para ver a m√°gica acontecer.</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        function app() {
            return {
                currentRoute: 'tasks',
                items: [],
                newItem: { title: '', description: '' },
                logs: [],
                methods: ['GET', 'POST', 'PATCH', 'DELETE'],
                isLoading: false,
                userLevel: 'beginner', // beginner | advanced
                toasts: [],
                
                // Tutorial System
                tutorial: {
                    active: false,
                    step: 0
                },
                tutorialSteps: [
                    { 
                        title: "Bem-vindo ao EasyPython Explorer! üëã", 
                        text: "Esta interface foi criada para te ensinar como APIs funcionam na pr√°tica. Vamos fazer um tour r√°pido?" 
                    },
                    { 
                        title: "Rotas da API", 
                        text: "Aqui voc√™ escolhe qual 'recurso' quer gerenciar. 'Tarefas' permite criar e editar. 'Usu√°rios' √© apenas para leitura." 
                    },
                    { 
                        title: "Criando Dados (POST)", 
                        text: "Use este formul√°rio para enviar informa√ß√µes para o servidor. Em termos t√©cnicos, isso √© uma requisi√ß√£o POST." 
                    },
                    { 
                        title: "Visualizando Dados (GET)", 
                        text: "Aqui aparecem os itens salvos no banco de dados. O navegador faz um pedido GET para buscar essa lista." 
                    },
                    { 
                        title: "O Console M√°gico", 
                        text: "Tudo o que acontece nos bastidores aparece aqui. √â como um raio-X da comunica√ß√£o entre seu navegador e o servidor." 
                    }
                ],

                get currentStep() {
                    return this.tutorialSteps[this.tutorial.step];
                },

                init() {
                    this.fetchItems();
                    
                    // Auto-start tutorial if first visit (simulated)
                    if (!localStorage.getItem('tutorialDone')) {
                        setTimeout(() => this.startTutorial(), 1000);
                    }
                },

                // Tutorial Methods
                startTutorial() {
                    this.tutorial.active = true;
                    this.tutorial.step = 0;
                    this.userLevel = 'beginner'; // Force beginner mode for tutorial
                },
                nextStep() {
                    if (this.tutorial.step < this.tutorialSteps.length - 1) {
                        this.tutorial.step++;
                    } else {
                        this.endTutorial();
                    }
                },
                endTutorial() {
                    this.tutorial.active = false;
                    localStorage.setItem('tutorialDone', 'true');
                    this.showToast('success', 'Tutorial Conclu√≠do!', 'Agora voc√™ est√° pronto para explorar.');
                },

                // Routing
                switchRoute(route) {
                    this.currentRoute = route;
                    this.items = [];
                    this.fetchItems();
                    
                    // Update available methods based on route
                    if (route === 'users') {
                        this.methods = ['GET'];
                        this.showToast('info', 'Modo Leitura', 'A rota de Usu√°rios √© protegida contra altera√ß√µes.');
                    } else {
                        this.methods = ['GET', 'POST', 'PATCH', 'DELETE'];
                    }
                },

                // API Interactions
                async fetchItems() {
                    this.isLoading = true;
                    await this.apiCall('GET', '');
                    this.isLoading = false;
                },

                async createItem() {
                    if (!this.newItem.title) {
                        this.showToast('error', 'Ops!', 'O t√≠tulo √© obrigat√≥rio.');
                        return;
                    }
                    this.isLoading = true;
                    const success = await this.apiCall('POST', '', this.newItem);
                    if (success) {
                        this.newItem = { title: '', description: '' };
                        this.showToast('success', 'Sucesso!', 'Item criado no servidor.');
                        // Refresh list
                        this.fetchItems();
                    }
                    this.isLoading = false;
                },

                async deleteItem(id) {
                    if (!confirm('Tem certeza que deseja apagar?')) return;
                    const success = await this.apiCall('DELETE', `${id}/`);
                    if (success) {
                        this.items = this.items.filter(i => i.id !== id);
                        this.showToast('success', 'Apagado!', 'O item foi removido do banco de dados.');
                    }
                },

                async toggleItem(item) {
                    const original = item.completed;
                    item.completed = !item.completed; // Optimistic update
                    
                    const success = await this.apiCall('PATCH', `${item.id}/`, { completed: item.completed });
                    if (!success) {
                        item.completed = original; // Revert
                        this.showToast('error', 'Erro', 'N√£o foi poss√≠vel atualizar o status.');
                    }
                },

                // Core API Logic
                async apiCall(method, path, body = null) {
                    const url = `/api/${this.currentRoute}/${path}`;
                    const logId = Date.now();
                    
                    // Add pending log
                    this.logs.unshift({
                        id: logId,
                        method,
                        url,
                        status: 0, // Pending
                        payload: body
                    });

                    try {
                        const options = {
                            method,
                            headers: { 'Content-Type': 'application/json' }
                        };
                        if (body) options.body = JSON.stringify(body);

                        const res = await fetch(url, options);
                        
                        // Update log with status
                        const logIndex = this.logs.findIndex(l => l.id === logId);
                        if (logIndex !== -1) {
                            this.logs[logIndex].status = res.status;
                        }

                        if (!res.ok) throw new Error(`HTTP ${res.status}`);

                        // Handle response data
                        if (method === 'GET') {
                            this.items = await res.json();
                        }
                        return true;

                    } catch (error) {
                        console.error(error);
                        const logIndex = this.logs.findIndex(l => l.id === logId);
                        if (logIndex !== -1) {
                            this.logs[logIndex].status = 'ERR';
                        }
                        this.showToast('error', 'Erro de Conex√£o', 'N√£o foi poss√≠vel falar com o servidor.');
                        return false;
                    }
                },

                // Toast System
                showToast(type, title, message) {
                    const id = Date.now();
                    const emojis = { success: '‚úÖ', error: '‚ùå', info: 'üí°' };
                    this.toasts.push({ id, type, title, message, emoji: emojis[type], visible: true });
                    
                    setTimeout(() => {
                        const index = this.toasts.findIndex(t => t.id === id);
                        if (index !== -1) this.toasts[index].visible = false;
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>
